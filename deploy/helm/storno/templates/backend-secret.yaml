apiVersion: v1
kind: Secret
metadata:
  name: {{ include "storno.fullname" . }}-backend
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "storno.componentLabels" (dict "component" "backend" "context" .) | nindent 4 }}
  annotations:
    # Force pod restart when the Secret changes.
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  APP_ENV: {{ .Values.backend.env.APP_ENV | quote }}
  APP_SECRET: {{ required "backend.env.APP_SECRET is required" .Values.backend.env.APP_SECRET | quote }}
  DATABASE_URL: {{ include "storno.databaseUrl" . | quote }}
  JWT_PASSPHRASE: {{ required "backend.env.JWT_PASSPHRASE is required" .Values.backend.env.JWT_PASSPHRASE | quote }}
  REDIS_URL: {{ include "storno.redisUrl" . | quote }}
  LOCK_DSN: {{ if .Values.backend.env.LOCK_DSN }}{{ .Values.backend.env.LOCK_DSN | quote }}{{ else }}{{ include "storno.redisUrl" . | quote }}{{ end }}
  MESSENGER_TRANSPORT_DSN: {{ if .Values.backend.env.MESSENGER_TRANSPORT_DSN }}{{ .Values.backend.env.MESSENGER_TRANSPORT_DSN | quote }}{{ else }}{{ printf "%s/messages" (include "storno.redisUrl" .) | quote }}{{ end }}
  CENTRIFUGO_API_URL: {{ include "storno.centrifugoApiUrl" . | quote }}
  CENTRIFUGO_API_KEY: {{ .Values.backend.env.CENTRIFUGO_API_KEY | quote }}
  CENTRIFUGO_TOKEN_HMAC_SECRET: {{ .Values.backend.env.CENTRIFUGO_TOKEN_HMAC_SECRET | quote }}
  MAILER_DSN: {{ .Values.backend.env.MAILER_DSN | quote }}
  MAIL_FROM: {{ .Values.backend.env.MAIL_FROM | quote }}
  FRONTEND_URL: {{ .Values.backend.env.FRONTEND_URL | quote }}
  CORS_ALLOW_ORIGIN: {{ .Values.backend.env.CORS_ALLOW_ORIGIN | quote }}
  WKHTMLTOPDF_PATH: {{ .Values.backend.env.WKHTMLTOPDF_PATH | quote }}
  WKHTMLTOIMAGE_PATH: {{ .Values.backend.env.WKHTMLTOIMAGE_PATH | quote }}
  JAVA_PATH: {{ .Values.backend.env.JAVA_PATH | quote }}
  JAVA_SERVICE_URL: {{ .Values.backend.env.JAVA_SERVICE_URL | quote }}
  LICENSE_KEY: {{ .Values.backend.env.LICENSE_KEY | quote }}
  LICENSE_SERVER_URL: {{ .Values.backend.env.LICENSE_SERVER_URL | quote }}
  STRIPE_SECRET_KEY: {{ .Values.backend.env.STRIPE_SECRET_KEY | quote }}
  STRIPE_PUBLISHABLE_KEY: {{ .Values.backend.env.STRIPE_PUBLISHABLE_KEY | quote }}
  STRIPE_WEBHOOK_SECRET: {{ .Values.backend.env.STRIPE_WEBHOOK_SECRET | quote }}
  STRIPE_CONNECT_WEBHOOK_SECRET: {{ .Values.backend.env.STRIPE_CONNECT_WEBHOOK_SECRET | quote }}
  STRIPE_PLATFORM_FEE_PERCENT: {{ .Values.backend.env.STRIPE_PLATFORM_FEE_PERCENT | quote }}
  BILLING_COMPANY_ID: {{ .Values.backend.env.BILLING_COMPANY_ID | quote }}
  STORAGE_ENCRYPTION_KEY: {{ .Values.backend.env.STORAGE_ENCRYPTION_KEY | quote }}
  AWS_S3_BUCKET: {{ .Values.backend.env.AWS_S3_BUCKET | quote }}
  AWS_DEFAULT_REGION: {{ .Values.backend.env.AWS_DEFAULT_REGION | quote }}
  AWS_ACCESS_KEY_ID: {{ .Values.backend.env.AWS_ACCESS_KEY_ID | quote }}
  AWS_SECRET_ACCESS_KEY: {{ .Values.backend.env.AWS_SECRET_ACCESS_KEY | quote }}
  OAUTH_ANAF_CLIENT_ID: {{ .Values.backend.env.OAUTH_ANAF_CLIENT_ID | quote }}
  OAUTH_ANAF_CLIENT_SECRET: {{ .Values.backend.env.OAUTH_ANAF_CLIENT_SECRET | quote }}
  OAUTH_ANAF_CLIENT_REDIRECT_URI: {{ .Values.backend.env.OAUTH_ANAF_CLIENT_REDIRECT_URI | quote }}
  REDIRECT_AFTER_OAUTH: {{ .Values.backend.env.REDIRECT_AFTER_OAUTH | quote }}
  OAUTH_GOOGLE_CLIENT_ID: {{ .Values.backend.env.OAUTH_GOOGLE_CLIENT_ID | quote }}
  OAUTH_GOOGLE_CLIENT_SECRET: {{ .Values.backend.env.OAUTH_GOOGLE_CLIENT_SECRET | quote }}
  OAUTH_GOOGLE_CLIENT_REDIRECT_URI: {{ .Values.backend.env.OAUTH_GOOGLE_CLIENT_REDIRECT_URI | quote }}
  TURNSTILE_SECRET_KEY: {{ .Values.backend.env.TURNSTILE_SECRET_KEY | quote }}
  REGISTRATION_ENABLED: {{ .Values.backend.env.REGISTRATION_ENABLED | quote }}
