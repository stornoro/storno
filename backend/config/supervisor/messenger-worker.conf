;
; Supervisor config for Symfony Messenger workers.
; Copy to /etc/supervisor/conf.d/messenger-worker.conf and adjust paths.
;
; Usage:
;   supervisorctl reread
;   supervisorctl update
;   supervisorctl start messenger-consume:*
;

[program:messenger-consume]
command=php /var/www/backend/bin/console messenger:consume async --time-limit=3600 --memory-limit=256M --limit=500
user=www-data
numprocs=2
startsecs=0
autostart=true
autorestart=true
startretries=10
process_name=%(program_name)s_%(process_num)02d
stdout_logfile=/var/log/supervisor/messenger-consume-%(process_num)02d.log
stderr_logfile=/var/log/supervisor/messenger-consume-%(process_num)02d-error.log

; Graceful shutdown timeout (seconds)
stopwaitsecs=60
stopasgroup=true
killasgroup=true

[program:scheduler-consume]
command=php /var/www/backend/bin/console messenger:consume scheduler_default --time-limit=3600 --memory-limit=256M
user=www-data
numprocs=1
startsecs=0
autostart=true
autorestart=true
startretries=10
process_name=%(program_name)s_%(process_num)02d
stdout_logfile=/var/log/supervisor/scheduler-consume.log
stderr_logfile=/var/log/supervisor/scheduler-consume-error.log

; Graceful shutdown timeout (seconds)
stopwaitsecs=60
stopasgroup=true
killasgroup=true
